<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type="image/png" href="/favicon.png">
    <title>FlyWheel Web Server</title>
    <script src="/scripts.js"></script>
    <script src="/power-settings.js"></script>
    <!-- Подключаем библиотеку Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
    
        <div class="connection-status">
            <span id="connectionIndicator" class="status-indicator"></span>
            Соединение с сервером  <p>Сигнал, dBm.: <span id="Signal">0</span></p>
        </div>
                <!-- Модальные окна -->

                  <!-- Модальное окно настроек батареи -->

                <div id="batteryModal" class="modal">
                    <div class="modal-content">
                        <span class="close" id="closeBattery">&times;</span>
                        <p>Информация о батарее</p>
                        
                        <!-- Текущее напряжение (в Вольтах) -->
                       
                        <p>Текущее напряжение, В: <span id="batt_voltage">0</span></p>
                        <p>Ток заряда/разряда, A: <span id="batt_curr">0</span></p>
                        <p>Уровень заряда, %: <span id="chargeLevel">85</span></p>
                       
                         <!-- Нижний порог отключения -->
                        <div class="input-row">
                            <label for="lowThreshold">Нижний порог отключения, В:</label>
                            <input type="number" id="lowThreshold" min="38" max="50" step="0.1" value="48">
                        </div>

                        <!-- Верхний порог напряжения -->
                        <div class="input-row">
                            <label for="highThreshold">Верхний порог напряжения, В:</label>
                            <input type="number" id="highThreshold" min="43" max="64" step="0.1" value="54">
                        </div>
                        <!-- Ползунок для установки максимального тока -->
                        <label for="maxCurrentRange">Максимальный ток, А: <span id="maxCurrentValue">1</span></label>
                        <input type="range" id="maxCurrentRange" min="0" max="80" step="0.1" value="30" oninput="updateMaxCurrent(this.value)" style="width: 300px;">
                        <!-- Кнопка Сохранить -->
                        <button onclick="saveBatterySettings()">Сохранить</button>
                        <div id="confirmationMessage" style="margin-top: 10px; color: rgb(11, 226, 11); display: none;"></div>
                    </div>
                </div>

            <!-- Модальное окно параметров нагрузки -->
        <div id="loadSettingsModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeLoadSettings">&times;</span>
                <h2>Параметры нагрузки</h2>
                <div class="input-row">
                    <label for="maxLoad">Максимальная нагрузка,(кВт):</label>
                    <input type="number" id="maxLoad" min="1" max="30" step="0.1" value="10">
                </div>
                <div class="input-row">
                    <label for="outputVoltage">Выходное напряжение,(В):</label>
                    <input type="number" id="outputVoltage" min="219" max="240" step="1" value="230">
                </div>  
                <div class="input-row">
                    <label for="maxCurrentDifference">Макс. разница тока нагрузки,(А):</label>
                    <input type="number" id="maxCurrentDifference" min="3" max="15" step="1" value="5">
                </div>
                <!-- Таблица с фазами -->
                <h3>Данные по фазам</h3>
                <table class="phase-table">
                    <thead>
                        <tr>
                            <th>Параметр</th>
                            <th>Фаза A</th>
                            <th>Фаза B</th>
                            <th>Фаза C</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Напряжение (В)</td>
                            <td id="v_ac_out_1">0</td>
                            <td id="v_ac_out_2">0</td>
                            <td id="v_ac_out_3">0</td>
                        </tr>
                        <tr>
                            <td>Ток (А)</td>
                            <td id="I_AC_Out_1">0</td>
                            <td id="I_AC_Out_2">0</td>
                            <td id="I_AC_Out_3">0</td>
                        </tr>
                        <tr>
                            <td>Мощность (кВт)</td>
                            <td id="powerPhaseA">0</td>
                            <td id="powerPhaseB">0</td>
                            <td id="powerPhaseC">0</td>
                        </tr>
                    </tbody>
                </table>
                <!-- Суммарная мощность -->
                <p>Общая мощность нагрузки, КВт: <span id="total_load">0</span></p>
                 <!-- Кнопка Сохранить -->
                 <button id="saveLoadSettings" onclick="saveLoadSettings()">Сохранить</button>
                 <div id="loadConfirmationMessage" style="margin-top: 10px; color: rgb(11, 226, 11); display: none;"></div>
            </div>
        </div>

          <!--Модальное окно инвертора --> 
        <div id="inverterModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeInverter">&times;</span>
                <p>Информация о инверторе</p>
            </div>
        </div>

          <!--Модальное окно Ветряка --> 
          <div id="WindTurbineModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeWindTurbine">&times;</span>
                <p>Информация о Ветрогенераторе</p>
            </div>
        </div>

          <!--Модальное окно маховика-->
          <div id="FlyWheelModal" class="modal">
            <div class="modal-content">
                <span id="closeFlyWheel" class="close">&times;</span>
                <h2>Параметры маховика</h2>
        
                <!-- Данные маховика -->
                <div class="flywheel-data">
                    <p><strong>Обороты в минуту:</strong> <span id="rpmValue">0</span> об/мин</p>
                    <p><strong>Потребление тока:</strong> <span id="currentValue">0</span> A</p>
                    <p><strong>Напряжение питания:</strong> <span id="voltageValue">0</span> V</p>
                    <p><strong>Генерация:</strong> <span id="generationValue">0</span> W</p>
                </div>
        
                <!-- Переключатели для обмоток -->
                <div class="coil-switches">
                    <h3>Управление обмотками</h3>
                    <label class="switch">
                        <input type="checkbox" id="coil1">
                        <span class="slider"></span> Обмотка 1
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="coil2">
                        <span class="slider"></span> Обмотка 2
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="coil3">
                        <span class="slider"></span> Обмотка 3
                    </label>
                    <label class="switch">
                        <input type="checkbox" id="coil4">
                        <span class="slider"></span> Обмотка 4
                    </label>
                </div>
                <button id="saveLoadSettings" onclick="saveFlyWheelSettings()">Сохранить</button>
                <div id="loadConfirmationMessage" style="margin-top: 10px; color: rgb(11, 226, 11); display: none;"></div>
            </div> 
        </div>
     <!-- Модальное окно для логина -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <h2>Введите логин и пароль</h2>
                <input type="text" id="username" placeholder="Логин">
                <input type="password" id="password" placeholder="Пароль">
                <button onclick="login()">Войти</button>
            </div>
        </div>
    
      <!-- Модальное окно для переключения режима Wi-Fi -->
        <div id="modeConfirmationModal" class="modal">
            <div class="modal-content">
                <h2>Подтверждение переключения режима</h2>
                <p>Переключение режима Wi-Fi приведёт к перезагрузке устройства и смене режима.</p><br>
                 <p> Вы уверены, что хотите продолжить?</p>
                <button onclick="confirmModeSwitch()">Да</button>
                <button onclick="cancelModeSwitch()">Нет</button>
            </div>
        </div>
    
        <h2>FlyWheel Control Panel</h2>


        <!-- Вкладки -->
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'control')">Управление</div>
            <div class="tab" onclick="openTab(event, 'monitor')">Мониторинг</div>
            <div class="tab" onclick="openTab(event, 'settings')">Настройки</div>
        </div>

		 <!-- Вкладка Управление -->
<div id="control" class="tabcontent active">
   
    <div class="icon-container">
             <!-- Иконка батареи -->
             <div class="icon battery-icon" id="batteryIcon">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                     width="60" height="60" viewBox="0 0 3100 1560" style="border: 1px solid red" preserveAspectRatio="xMidYMid meet">
                    
                    <!-- Заливка, изменяющаяся по уровню заряда -->
                    
                    <rect id="batteryFill" x="320" y="160" width="3300" height="1400" fill="green" />
                    <!-- Контур батарейки -->
                    <g fill="none" stroke="black" stroke-width="100">
                        <path d="M415 1500 c-63 -31 -116 -93 -132 -153 -7 -28 -13 -100 -13 -159 l0
                            -108 -108 0 c-71 0 -112 -4 -120 -12 -17 -17 -17 -569 0 -586 8 -8 49 -12 120
                            -12 l108 0 0 -104 c0 -154 11 -200 62 -253 24 -24 61 -52 84 -63 39 -20 66
                            -20 1255 -20 1377 0 1275 -6 1353 81 24 26 46 62 50 80 11 56 7 1131 -5 1173
                            -6 21 -28 58 -50 81 -74 80 18 75 -1348 75 -1197 0 -1217 0 -1256 -20z m2511
                            -93 c23 -15 46 -39 53 -53 17 -38 15 -1141 -2 -1172 -7 -12 -31 -32 -52 -45
                            l-40 -22 -1205 0 -1205 0 -39 24 c-67 42 -66 29 -66 631 0 580 0 581 51 629
                            13 12 37 26 54 30 17 5 549 9 1220 8 l1190 -2 41 -28z"/>
                    </g>
                </svg>     
            </div>
                   <!-- Иконка инвертора напряжения -->
        
                        <div class="icon inverter-icon" id="inverterIcon">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                        width="60.000000pt" height="30.000000pt" viewBox="0 0 172.000000 85.000000" style="border: 1px solid red"
                        preserveAspectRatio="xMidYMid meet">

                        <g transform="translate(0.000000,85.000000) scale(0.100000,-0.100000)"
                        fill="#000000" stroke="none">
                        <path d="M921 826 c-49 -27 -50 -37 -51 -404 0 -372 2 -386 55 -410 41 -19
                        697 -17 734 2 49 26 51 41 51 406 0 365 -2 380 -51 406 -39 20 -702 20 -738 0z
                        m709 -33 c0 -10 -703 -713 -712 -713 -5 0 -8 153 -8 340 0 327 1 341 20 360
                        19 19 33 20 360 20 187 0 340 -3 340 -7z m40 -373 c0 -327 -1 -341 -20 -360
                        -19 -19 -33 -20 -360 -20 -187 0 -340 3 -340 7 0 10 703 713 712 713 5 0 8
                        -153 8 -340z"/>
                        <path d="M1025 690 c-12 -4 -27 -15 -35 -25 -20 -25 7 -39 37 -20 35 23 64 18
                        111 -20 24 -19 53 -37 64 -41 50 -15 144 33 108 56 -10 6 -23 4 -37 -5 -33
                        -22 -65 -18 -103 13 -63 52 -97 62 -145 42z"/>
                        <path d="M1290 260 c0 -19 7 -20 140 -20 133 0 140 1 140 20 0 19 -7 20 -140
                        20 -133 0 -140 -1 -140 -20z"/>
                        <path d="M1290 180 c0 -18 7 -20 60 -20 53 0 60 2 60 20 0 18 -7 20 -60 20
                        -53 0 -60 -2 -60 -20z"/>
                        <path d="M1450 180 c0 -18 7 -20 60 -20 53 0 60 2 60 20 0 18 -7 20 -60 20
                        -53 0 -60 -2 -60 -20z"/>
                        <path  id="leftLine" d="M0 425 l0 -25 430 0 430 0 0 25 0 25 -430 0 -430 0 0 -25z"/>
                        </g>
                    </svg>
           
        </div>
        <!-- Иконка сети электропитания -->
          <div class="icon power-grid-icon">
            <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
            width="65.000000pt" height="65.000000pt" viewBox="0 0 175.000000 175.000000"style="border: 1px solid red"
            preserveAspectRatio="xMidYMid meet">
           
           <g transform="translate(25.000000,170.000000) scale(0.100000,-0.100000)"
           fill="#000000" stroke="none">
           <path d="M656 1588 c-8 -29 -25 -93 -38 -142 l-24 -90 -204 -68 c-113 -37
           -215 -68 -227 -68 -27 0 -31 -24 -8 -47 18 -18 11 -33 -16 -33 -30 0 -22 -20
           9 -21 25 -1 26 -1 4 -7 -23 -7 -28 -29 -5 -24 6 1 14 -2 18 -8 4 -6 -5 -10
           -20 -10 -16 0 -24 -4 -20 -10 4 -6 15 -8 26 -5 11 4 19 2 19 -4 0 -6 -11 -11
           -25 -11 -34 0 -32 -18 3 -23 l27 -4 -27 -2 c-16 0 -28 -5 -28 -10 0 -11 51
           -19 89 -13 22 3 28 9 28 28 1 19 -5 24 -24 24 -13 0 -22 4 -18 10 3 5 12 7 19
           4 8 -3 17 -1 21 5 6 11 -7 15 -32 12 -7 -1 -13 3 -13 9 0 5 12 10 26 10 22 0
           24 3 15 14 -8 10 -9 16 -1 21 15 10 2 25 -22 25 -12 0 -19 3 -15 6 5 5 368 6
           373 1 5 -6 -18 -215 -25 -233 -11 -25 -304 -162 -367 -171 -33 -4 -44 -10 -44
           -23 0 -10 7 -20 15 -24 22 -8 18 -26 -5 -26 -31 0 -24 -20 8 -21 20 -1 22 -2
           7 -6 -35 -9 -41 -23 -9 -24 l29 -1 -27 -11 c-36 -14 -36 -25 -1 -30 l28 -4
           -27 -2 c-36 -1 -37 -21 -1 -21 14 0 23 -3 19 -7 -4 -4 -13 -8 -19 -8 -7 0 -14
           -4 -17 -10 -6 -11 73 -20 97 -11 11 5 12 10 4 19 -8 10 -7 17 1 25 9 9 5 12
           -18 13 -26 1 -27 2 -6 7 30 9 30 25 0 34 l-23 6 23 1 c12 1 22 6 22 11 0 6
           -10 10 -22 11 -22 1 -22 1 2 8 16 5 24 13 22 24 -3 15 12 17 148 17 88 0 150
           -4 150 -10 0 -11 -88 -574 -96 -612 -3 -18 -13 -28 -27 -30 -12 -2 -23 -11
           -25 -20 -3 -17 16 -18 288 -18 272 0 291 1 288 18 -2 9 -13 18 -25 20 -18 3
           -23 14 -33 75 -7 40 -31 183 -55 319 -23 136 -40 250 -37 253 7 7 277 6 296
           -1 9 -3 16 -12 16 -20 0 -8 10 -14 22 -14 12 0 18 -3 14 -7 -4 -4 -14 -8 -22
           -8 -23 0 -17 -19 8 -27 22 -6 21 -6 -4 -7 -16 -1 -28 -5 -28 -11 0 -5 12 -11
           28 -11 20 -1 22 -2 7 -6 -35 -8 -41 -23 -10 -23 15 0 25 -3 21 -7 -4 -4 -13
           -8 -19 -8 -7 0 -14 -4 -17 -10 -6 -12 74 -20 99 -10 14 6 14 7 -2 16 -9 6 -22
           7 -27 4 -6 -3 -10 -1 -10 4 0 6 9 11 19 11 32 0 35 20 4 21 -23 2 -24 2 -5 6
           28 5 29 23 1 23 -11 0 -17 5 -14 10 3 6 16 10 28 10 24 0 13 16 -18 23 -18 4
           -18 5 2 6 31 2 39 21 9 21 -32 0 -33 10 -5 34 26 22 16 34 -39 47 -37 8 -295
           112 -352 142 -24 12 -25 16 -28 134 l-3 121 56 7 c54 6 352 -6 308 -13 -17 -2
           -23 -10 -23 -28 0 -38 1 -39 15 -36 7 1 16 -2 20 -8 4 -6 -5 -10 -21 -10 -30
           0 -23 -15 11 -23 15 -4 13 -5 -7 -6 -16 0 -28 -5 -28 -10 0 -5 12 -12 28 -14
           l27 -4 -27 -2 c-38 -2 -35 -18 3 -23 42 -6 98 5 81 16 -10 6 -10 11 -1 22 9
           11 6 14 -17 15 -21 1 -24 3 -9 6 34 8 41 23 11 23 -15 0 -25 4 -21 10 3 5 15
           10 26 10 30 0 22 20 -8 21 -21 1 -23 2 -8 6 34 8 41 23 12 23 -30 0 -36 20
           -12 40 22 18 18 40 -7 40 -13 0 -112 30 -220 66 l-198 66 -9 36 c-6 20 -19 75
           -31 122 -36 148 -50 163 -74 78z m47 -140 c-6 -11 -31 -10 -38 2 -3 5 0 29 6
           52 l12 43 12 -45 c7 -25 10 -48 8 -52z m-3 -73 c17 -21 8 -27 -24 -19 -21 5
           -24 9 -15 20 15 18 24 18 39 -1z m10 -64 c0 -17 -34 -22 -49 -6 -14 13 -12 15
           17 15 18 0 32 -4 32 -9z m-127 -48 c-3 -21 -9 -42 -13 -46 -3 -4 -65 -6 -136
           -5 l-129 3 125 42 c158 54 160 54 153 6z m327 0 c66 -21 120 -41 120 -45 0 -4
           -56 -8 -124 -8 l-124 0 -4 45 c-2 25 0 45 5 45 4 0 62 -17 127 -37z m-268 -5
           c-9 -9 -12 -7 -12 12 0 19 3 21 12 12 9 -9 9 -15 0 -24z m98 7 c0 -28 -17 -34
           -27 -9 -3 9 0 20 8 25 19 12 19 12 19 -16z m-40 -40 c11 -13 7 -15 -25 -15
           -32 0 -36 2 -25 15 7 8 18 15 25 15 7 0 18 -7 25 -15z m20 -75 c0 -3 -9 -11
           -20 -18 -15 -9 -26 -10 -40 -2 -32 17 -23 29 20 27 22 -1 40 -4 40 -7z m-72
           -54 c-2 -1 -11 -8 -20 -15 -16 -12 -18 -10 -18 19 0 32 0 33 20 15 11 -10 19
           -19 18 -19z m92 -3 c0 -26 -1 -26 -17 -10 -16 16 -16 19 -3 27 20 13 20 13 20
           -17z m420 23 c0 -11 -19 -15 -25 -6 -3 5 1 10 9 10 9 0 16 -2 16 -4z m-451
           -67 c23 -19 23 -20 5 -34 -33 -25 -54 -28 -75 -9 -19 17 -19 18 8 40 34 28 32
           28 62 3z m-492 -35 c-3 -3 -12 -4 -19 -1 -8 3 -5 6 6 6 11 1 17 -2 13 -5z
           m423 -44 c0 -9 -42 -32 -47 -26 -3 3 -3 17 1 31 6 22 9 24 26 13 11 -7 20 -15
           20 -18z m110 -5 l0 -35 -25 16 c-24 16 -25 18 -9 35 25 28 34 23 34 -16z m-45
           -45 c4 -6 -10 -10 -34 -10 -45 0 -50 6 -24 25 18 13 45 6 58 -15z m3 -36 l23
           -7 -22 -23 c-12 -13 -27 -24 -32 -24 -17 0 -67 41 -62 51 7 10 59 12 93 3z
           m-160 -76 l-3 -63 -135 -3 c-82 -2 -131 1 -125 7 11 10 246 120 258 121 4 0 7
           -28 5 -62z m378 1 c65 -28 121 -53 123 -55 2 -2 -57 -4 -132 -4 l-137 0 2 55
           c1 32 7 55 13 55 6 0 65 -23 131 -51z m-308 18 l22 -23 -25 -24 -25 -23 0 46
           c0 26 1 47 3 47 2 0 13 -10 25 -23z m128 -54 c-4 -4 -16 3 -28 15 -22 21 -22
           22 -3 36 19 14 21 13 29 -15 5 -16 6 -32 2 -36z m-36 -17 c11 -14 6 -16 -41
           -16 l-52 0 23 25 c24 25 43 23 70 -9z m-500 -66 c0 -5 -5 -10 -11 -10 -5 0 -7
           5 -4 10 3 6 8 10 11 10 2 0 4 -4 4 -10z m945 0 c3 -5 -1 -10 -10 -10 -9 0 -13
           5 -10 10 3 6 8 10 10 10 2 0 7 -4 10 -10z m-450 -30 c-16 -16 -32 -30 -36 -30
           -4 0 -17 14 -29 30 l-21 30 57 0 58 0 -29 -30z m-102 -102 c-23 -23 -44 -40
           -47 -37 -4 4 1 38 20 118 l5 24 32 -31 32 -32 -42 -42z m167 45 c6 -32 14 -67
           16 -78 3 -12 -12 -1 -40 30 l-45 50 26 28 c15 15 28 27 29 27 1 0 8 -26 14
           -57z m-10 -135 c0 -9 -102 -8 -145 1 l-30 6 44 48 44 48 43 -48 c24 -26 43
           -51 44 -55z m-550 88 c0 -3 -4 -8 -10 -11 -5 -3 -10 -1 -10 4 0 6 5 11 10 11
           6 0 10 -2 10 -4z m560 -144 c0 -4 -22 -30 -50 -57 l-50 -49 -50 49 c-27 27
           -50 53 -50 57 0 4 45 8 100 8 55 0 100 -4 100 -8z m-201 -210 c-41 -39 -75
           -69 -77 -67 -4 4 10 96 29 194 l11 54 55 -55 55 -55 -73 -71z m241 174 c0 -3
           9 -53 21 -111 11 -59 19 -111 17 -115 -2 -5 -36 23 -77 62 l-73 70 48 49 c43
           44 64 58 64 45z m-40 -231 l95 -95 -193 0 -193 0 20 28 c23 33 158 162 169
           162 4 0 50 -43 102 -95z"/>
           </g>
           </svg>
           
           
        </div>


            <!-- Иконка нагрузки -->
            <div class="icon power-icon" id="loadIcon">
                <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                width="35.000000pt" height="35.000000pt" viewBox="0 0 2000.000000 2000.000000" style="border: 1px solid red"
                preserveAspectRatio="xMidYMid meet">
            
            <g transform="translate(0.000000,2000.000000) scale(0.100000,-0.100000)"
            fill="#000000" stroke="none">
            <path d="M9720 19994 c-368 -25 -539 -44 -777 -85 -1570 -269 -2983 -1137
            -3945 -2423 -600 -801 -993 -1717 -1162 -2711 -23 -132 -54 -389 -68 -560 -18
            -222 -15 -743 6 -945 91 -895 347 -1721 904 -2910 60 -129 274 -568 475 -975
            470 -954 617 -1272 769 -1670 210 -548 328 -1053 328 -1410 0 -409 145 -748
            423 -994 159 -140 350 -239 551 -285 155 -36 234 -37 2856 -34 l2575 4 95 21
            c382 85 693 320 863 650 102 199 133 336 147 654 15 346 63 616 174 985 149
            495 349 954 859 1979 347 695 543 1098 659 1355 482 1064 714 1856 789 2695
            16 178 16 664 0 860 -57 713 -211 1353 -473 1974 -322 762 -774 1428 -1365
            2012 -202 200 -252 246 -413 380 -985 818 -2192 1311 -3480 1419 -128 11 -691
            21 -790 14z m775 -1268 c986 -104 1871 -464 2629 -1070 763 -610 1328 -1423
            1635 -2353 216 -656 296 -1418 215 -2053 -68 -537 -248 -1140 -546 -1835 -127
            -295 -277 -609 -596 -1250 -522 -1047 -680 -1384 -862 -1840 -285 -714 -437
            -1345 -458 -1905 l-7 -175 -937 -3 -938 -2 0 1907 c0 2126 5 1979 -71 2132
            -73 147 -209 262 -372 313 -102 32 -273 32 -369 0 -195 -65 -343 -214 -416
            -419 -15 -44 -17 -194 -19 -1991 l-3 -1942 -938 2 -937 3 -2 80 c-22 785 -276
            1635 -852 2842 -59 125 -261 539 -449 918 -187 380 -381 780 -432 890 -661
            1433 -858 2348 -730 3382 128 1036 569 1995 1267 2758 894 978 2100 1550 3433
            1629 132 8 619 -4 755 -18z"/>
            <path d="M8592 14350 c-111 -29 -187 -74 -277 -165 -135 -135 -192 -281 -182
            -470 9 -161 67 -294 177 -405 75 -75 147 -120 252 -158 l73 -27 1330 -3 c1479
            -3 1419 -5 1560 64 388 190 474 695 170 1000 -83 84 -173 137 -280 164 -76 20
            -111 20 -1414 19 -1282 0 -1339 -1 -1409 -19z"/>
            <path d="M8664 12490 c-109 -16 -197 -54 -290 -123 -241 -182 -314 -531 -167
            -796 53 -97 170 -209 263 -254 146 -71 49 -67 1535 -67 1487 0 1391 -4 1535
            67 100 50 222 170 268 265 56 115 67 161 66 293 0 104 -3 130 -26 193 -70 194
            -207 331 -399 398 l-84 29 -1325 1 c-729 1 -1348 -2 -1376 -6z"/>
            <path d="M7415 4363 c-124 -16 -255 -83 -350 -178 -246 -245 -248 -630 -5
            -876 92 -93 177 -142 302 -174 56 -14 81 -24 63 -24 -52 -2 -137 -29 -215 -68
            -196 -100 -330 -322 -330 -549 0 -173 62 -318 189 -444 91 -89 167 -132 294
            -165 58 -15 80 -24 60 -25 -61 0 -191 -50 -268 -101 -170 -114 -275 -310 -275
            -515 0 -103 29 -217 77 -303 52 -95 170 -209 264 -254 139 -68 121 -67 860
            -67 l667 0 81 -92 c45 -51 87 -98 94 -103 6 -6 43 -37 81 -69 194 -164 433
            -279 688 -331 108 -21 152 -25 313 -25 161 0 205 4 313 25 327 67 585 213 834
            474 l115 121 664 0 c738 0 720 -1 859 67 105 52 222 170 273 274 142 290 47
            634 -223 808 -66 43 -197 90 -253 92 -21 0 1 9 61 24 125 32 210 81 302 174
            224 226 241 570 42 824 -46 59 -137 134 -202 167 -49 25 -166 60 -204 61 -21
            1 -4 7 49 20 129 32 218 81 310 174 118 118 171 235 182 401 16 253 -120 487
            -350 598 -145 71 51 66 -2779 65 -1404 -1 -2566 -4 -2583 -6z"/>
            </g>
            </svg>
            
        </div>

                    <!-- SVG иконка ветряка -->
        <div class="icon WindTurbineIcon" id="WindTurbineIcon">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg"
            width="70" height="70" viewBox="0 0 512.000000 512.000000" style="border: 1px solid red"
            preserveAspectRatio="xMidYMid meet" id="WindTurbineIcon">

            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
            fill="#000000" stroke="none">
                <path d="M2487 5103 c-8 -10 -18 -29 -21 -43 -8 -35 -116 -1324 -116 -1385 0
                -60 26 -107 71 -130 25 -13 53 -16 131 -13 98 3 100 4 128 35 16 18 33 47 38
                65 6 23 -8 212 -44 623 -29 325 -57 643 -63 708 -7 89 -13 123 -27 138 -22 24
                -75 25 -97 2z"/>
                <path d="M2455 3322 c-51 -24 -92 -72 -101 -118 -24 -127 51 -226 171 -228
                136 -1 224 137 165 259 -42 87 -150 127 -235 87z"/>
                <path d="M2120 3090 c-20 -3 -42 -10 -50 -15 -32 -19 -1077 -820 -1107 -848
                -38 -36 -41 -64 -12 -101 27 -34 53 -33 124 5 32 17 313 163 624 325 406 211
                575 304 599 329 30 32 38 59 33 109 -1 21 -84 158 -106 176 -21 18 -67 27
                -105 20z"/>
                <path d="M2929 3086 c-35 -11 -86 -76 -128 -161 -25 -50 -15 -105 26 -146 15
                -16 282 -161 593 -322 311 -162 592 -308 624 -326 72 -38 98 -39 125 -5 29 37
                26 65 -11 100 -30 28 -1074 829 -1107 849 -27 16 -89 22 -122 11z"/>
                <path d="M2450 2723 c0 -16 -95 -2467 -102 -2650 l-3 -73 182 0 c168 0 183 1
                183 18 1 55 -122 2699 -125 2710 -3 8 -26 12 -70 12 -55 0 -65 -3 -65 -17z"/>
            </g>
            </svg>

        </div>

        <div class="icon FlyWheelIcon" id="FlyWheelIcon">
            
          <svg width="60" height="60" viewBox="0 0 200 200" style="border: 1px solid red"  preserveAspectRatio="xMidYMid meet"
           xmlns="http://www.w3.org/2000/svg" id="FlyWheelIcon">
            <g transform="translate(20.000000,175.000000) scale(0.8000,-0.800000)"
                fill="#000000" stroke="none">
                <!-- Первый сектор (верхний правый) -->
                <path d="M100,100 L200,100 A100,100 0 0,0 100,0 Z" fill="red" />
                <!-- Второй сектор (верхний левый) -->
                <path d="M100,100 L100,0 A100,100 0 0,0 0,100 Z" fill="blue" />
                <!-- Третий сектор (нижний левый) -->
                <path d="M100,100 L0,100 A100,100 0 0,0 100,200 Z" fill="red" />
                <!-- Четвёртый сектор (нижний правый) -->
                <path d="M100,100 L100,200 A100,100 0 0,0 200,100 Z" fill="blue" />
                
                <!-- Окантовка круга -->
                <circle cx="100" cy="100" r="100" fill="none" stroke="black" stroke-width="5" />
              
                <!-- Текст для первого сектора (верхний правый) -->
                <text id="text1" x="150" y="50" font-size="12" fill="black" text-anchor="middle">Text 1</text>              
                <!-- Текст для второго сектора (верхний левый) -->
                <text id="text2" x="50" y="50" font-size="12" fill="white" text-anchor="middle">Text 2</text>
                <!-- Текст для третьего сектора (нижний левый) -->
                <text id="text3" x="50" y="150" font-size="12" fill="black" text-anchor="middle">Text 3</text>
                <!-- Текст для четвёртого сектора (нижний правый) -->
                <text id="text4" x="150" y="150" font-size="12" fill="white" text-anchor="middle">Text 4</text>
            </g>
          </svg>
              
        </div>










    </div>
    <br><br><br><br>
    <p>Напряжение питания, В: <span id="batt_voltage">0</span></p>
    <p>Скорость, Об.мин.: <span id="speed">0</span></p>

    
  
</div>

        <!-- Контент вкладки Мониторинг -->
        <div id="monitor" class="tabcontent">
           
            <p>Температура: <span id="temperature">0</span>°C</p>
            <p>Ток: <span id="current">0</span> A</p>

            <!-- Контейнер для графика -->
            <div id="chartContainer">
                <canvas id="speedChart"></canvas>
            </div>
        </div>

       <!-- Контент вкладки Настройки -->
        <div id="settings" class="tabcontent">
            <p>WIFI SSID: <span id="wifi_ssid_display">Loading...</span></p> 
            <p>Current IP: <span id="ip_address">Loading...</span></p>
            <p>Netmask: <span id="netmask">Loading...</span></p>
            <p>Gateway: <span id="gateway">Loading...</span></p>
            <p>Current Mode: <span id="network_mode">Loading...</span></p>
            
            <form id="wifiForm">
                <label for="wifi_ssid">Wi-Fi SSID:</label>
                <input type="text" id="wifi_ssid" name="wifi_ssid">
                
                <label for="wifi_password">Wi-Fi Password:</label>
                <input type="password" id="wifi_password" name="wifi_password">
                
                <!-- Кнопки для переключения режимов -->
                <button type="button" id="switchToAPButton" onclick="openModeConfirmation('AP')">Switch to AP</button>
                <button type="button" id="switchToSTAButton" onclick="openModeConfirmation('STA')">Switch to STA</button>
                
                <!-- Кнопка сохранения настроек -->
                <button type="button" onclick="saveSettings()">Save</button>
            </form>

                        <!-- Страница обновления прошивки -->
            <form id="uploadForm" enctype="multipart/form-data">
                <h3>Upload Firmware</h3>
                <input type="file" id="firmwareFile" name="firmware" accept=".bin">
                <br><br>
                <button type="button" onclick="uploadFirmware()">Upload Firmware</button>
                <p id="status"></p>
            </form>
        </div>
    </div>

    
        <script>
            // Закрытие модального окна (если нужно)
            document.getElementById("closeBattery").onclick = function() {
            document.getElementById("batteryModal").style.display = "none";
                }
        </script>
<script>
  
   
</script>

<script>
    const CHUNK_SIZE = 2048; // Размер одной части
    const MAX_RETRIES = 3;   // Максимальное количество попыток повторной отправки

    function uploadFirmware() {
        const fileInput = document.getElementById('firmwareFile');
        const status = document.getElementById('status');

        if (fileInput.files.length === 0) {
            status.innerHTML = "Please select a firmware file!";
            console.log("No file selected.");
            return;
        }

        const file = fileInput.files[0];
        const totalSize = file.size;
        let offset = 0; // Начальное смещение файла
        let chunkCounter = 1; // Счётчик частей
        let retryCount = 0; // Счётчик попыток для текущего чанка

        status.innerHTML = "Uploading firmware...";
        console.log(`Starting upload: ${file.name}, total size: ${totalSize} bytes`);

        // Функция отправки части данных
        function sendNextChunk() {
            const chunk = file.slice(offset, offset + CHUNK_SIZE);

            const formData = new FormData();
            formData.append('fileName', file.name); // Имя файла
            formData.append('totalSize', totalSize); // Общий размер файла
            formData.append('chunkNumber', chunkCounter); // Номер части
            formData.append("chunk", chunk); // Добавление части файла

            console.log(`Sending chunk ${chunkCounter} (size: ${chunk.size} bytes, attempt: ${retryCount + 1})`);

            // Отправка через fetch
            fetch('/ota', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(result => {
                console.log(`Chunk ${chunkCounter} uploaded successfully, received server response: ${result}`);
                offset += CHUNK_SIZE;
                chunkCounter++;
                retryCount = 0; // Сбросить количество попыток для следующего чанка
                status.innerHTML = `Uploaded ${Math.min(offset, totalSize)} of ${totalSize} bytes`;

                if (offset < totalSize) {
                    console.log(`Continuing upload: ${offset} of ${totalSize} bytes uploaded`);
                    sendNextChunk(); // Отправляем следующую часть только после успешного ответа
                } else {
                    status.innerHTML = "Firmware upload completed successfully!";
                    console.log("Upload completed successfully!");
                }
            })
            .catch(error => {
                console.error('Error uploading chunk:', error);
                retryCount++; // Увеличиваем количество попыток
                if (retryCount < MAX_RETRIES) {
                    console.log(`Retrying chunk ${chunkCounter} (attempt: ${retryCount + 1})`);
                    sendNextChunk(); // Повторно отправляем чанк
                } else {
                    status.innerHTML = "Error uploading firmware! Reached maximum retry attempts.";
                    console.error(`Failed to upload chunk ${chunkCounter} after ${MAX_RETRIES} attempts.`);
                }
            });
        }

        sendNextChunk(); // Начало отправки частей
    }
</script>
   



<script>
    /*
    
      // Логин и пароль для проверки
        const USERNAME = "admin";
        const PASSWORD = "12345";

        // Открытие модального окна при загрузке страницы
        window.onload = function() {
            if (!localStorage.getItem("authenticated")) {
                document.getElementById("loginModal").style.display = "flex";
                document.getElementById("content").style.display = "none"; // Скрыть содержимое до аутентификации
            }
        }

   */
			// Функция для скрытия линии
			function hideLeftLine() {
			    const leftLine = document.getElementById('leftLine');
			    if (leftLine) {
			        leftLine.style.display = 'none';  // Скрыть линию
			    }
			}
			
			// Функция для отображения линии
			function showLeftLine() {
			    const leftLine = document.getElementById('leftLine');
			    if (leftLine) {
			        leftLine.style.display = '';  // Показать линию (по умолчанию)
			    }
			}

    /*

        // Функция для входа
        function login() {
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            if (username === USERNAME && password === PASSWORD) {
                localStorage.setItem("authenticated", true); // Сохраняем статус входа
                document.getElementById("loginModal").style.display = "none"; // Скрываем модальное окно
                document.getElementById("content").style.display = "block"; // Показываем содержимое
            } else {
                alert("Неверный логин или пароль");
            }
        }
    */
    
    
        // Функция для переключения вкладок
        function openTab(event, tabName) {
            var i, tabcontent, tabs;
            
            // Скрываем все вкладки
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Убираем активный класс с вкладок
            tabs = document.getElementsByClassName("tab");
            for (i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            
            // Показываем текущую вкладку
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
        }

			

			     // Инициализация данных для графика
			var timeData = [];
			var speedData = [];
			var timeCounter = 0; // Счетчик времени в секундах
			
			var speedChart = new Chart(document.getElementById('speedChart'), {
			    type: 'line',
			    data: {
			        labels: timeData,
			        datasets: [{
			            label: 'Скорость (об/мин)',
			            data: speedData,
			            borderColor: 'rgba(75, 192, 192, 1)',
			            backgroundColor: 'rgba(75, 192, 192, 0.2)',
			            fill: true
			        }]
			    },
    options: {
        animation: {
            duration: 300, // Уменьшаем время анимации для более плавного обновления
            easing: 'easeOutQuad' // Используем более плавный эффект
        },
        scales: {
            x: {
                type: 'linear',
                position: 'bottom',
                title: {
                    display: true,
                    text: 'Время (сек)'
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Скорость (об/мин)'
                }
            }
        }
    }
});


		
		    // Функция для обновления значения максимального тока
		    function updateMaxCurrent(value) {
		        document.getElementById('maxCurrentValue').innerText = value;
		        
		        // Можно отправить это значение на сервер или использовать его для управления другими элементами
		        console.log('Установленный максимальный ток: ' + value + ' A');
		    }
		

// Функция для получения текущего времени в формате HH:MM:SS
function getCurrentTimeFormatted() {
    var now = new Date(); // Получаем текущее время

    var hours = now.getHours();   // Часы
    var minutes = now.getMinutes(); // Минуты
    var seconds = now.getSeconds(); // Секунды

    // Форматируем часы, минуты и секунды так, чтобы всегда было 2 цифры
    hours = hours < 10 ? '0' + hours : hours;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    seconds = seconds < 10 ? '0' + seconds : seconds;

    // Возвращаем строку в формате HH:MM:SS
    return hours + ':' + minutes + ':' + seconds;
}

       // Функция для обновления данных графика
function updateChart(newSpeed) {
    timeCounter++; // Увеличиваем счетчик времени
    var currentTime = getCurrentTimeFormatted();
    
    // Добавляем новые данные
    timeData.push(timeCounter);
    speedData.push(newSpeed);

    // Если массивы превышают длину 90, удаляем только первое значение
    if (timeData.length > 90) {
        timeData.shift();  
        speedData.shift();
    }

    // Обновляем график с плавной анимацией
    speedChart.update();  
}

// Функция для сохранения настроек
function saveSettings() {
    // Собираем данные из формы
    const ssid = document.getElementById('wifi_ssid').value;
    const password = document.getElementById('wifi_password').value;

    // Проверка наличия данных
    if (!ssid || !password) {
        alert("Пожалуйста, введите SSID и пароль");
        return;
    }

    // Формируем объект с данными
    const data = {
        ssid: ssid,
        password: password
    };

    // Отправляем данные на backend с использованием fetch
    fetch('/save_wifi_settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Ошибка сохранения настроек');
        }
    })
    .then(result => {
        alert('Настройки Wi-Fi сохранены');
        // Можно обновить страницу или показать сообщение о сохранении
    })
    .catch(error => {
        console.error('Ошибка:', error);
        alert('Не удалось сохранить настройки');
    });
}






        // Обновление данных каждые 0.5 секунды
      setInterval(updateData, 500); 
        
  
        // Функция для открытия модального окна подтверждения переключения режима
        function openModeConfirmation(mode) {
            var modal = document.getElementById('modeConfirmationModal');
            modal.style.display = 'flex';
            modal.dataset.mode = mode; // Сохраняем режим переключения
        }

       
 // Функция для подтверждения переключения режима
 function confirmModeSwitch() {
    var modal = document.getElementById('modeConfirmationModal');
    var mode = modal.dataset.mode;

    // Отправляем запрос на сервер для переключения режима
    fetch('/wifi_mode', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ mode: mode })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Режим успешно переключен на ' + (mode === 'AP' ? 'Access Point' : 'Station'));
        } else {
            alert('Ошибка при переключении режима.');
        }
    })
    .catch(error => {
        console.error('Ошибка:', error);
    });

    modal.style.display = 'none';
}

// Функция для отмены переключения режима
function cancelModeSwitch() {
    var modal = document.getElementById('modeConfirmationModal');
    modal.style.display = 'none';
}


// Функция для переключения видимости
function toggleVisibility() {
    const leftLine = document.getElementById('leftLine');
    if (leftLine) {
        // Если элемент видим, скрыть его, иначе показать
        if (leftLine.style.display === 'none') {
            showLeftLine();
        } else {
            hideLeftLine();
        }
    }
}

  setInterval(toggleVisibility, 500);

    // Обновление сетевых параметров каждую секунду
    setInterval(updateNetworkInfo, 1000);

    // Получение сетевых параметров сразу при загрузке страницы
    updateNetworkInfo();
    updateData();
   
    
    
    
    
    </script>
    
</body>
</html>
