<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" type="image/png" href="/favicon.png">
    <title>FlyWheel Web Server</title>
    
    <!-- Подключаем библиотеку Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
    
        <div class="connection-status">
            <span id="connectionIndicator" class="status-indicator"></span>
            Соединение с сервером
        </div>
                <!-- Модальные окна -->
                <div id="batteryModal" class="modal">
                    <div class="modal-content">
                        <span class="close" id="closeBattery">&times;</span>
                        <p>Информация о батарее</p>
                        
                        <!-- Текущее напряжение (в Вольтах) -->
                        <label for="currentVoltage">Текущее напряжение, В:</label>
                        <input type="text" id="currentVoltage" disabled value="12.5"> <!-- пример значения -->
                
                        <!-- Уровень заряда (в процентах) -->
                        <label for="chargeLevel">Уровень заряда, %:</label>
                        <input type="text" id="chargeLevel" disabled value="85"> <!-- пример значения -->
                
                        <!-- Нижний порог отключения (с меню прокрутки) -->
                        <label for="lowThreshold">Нижний порог отключения, В:</label>
                        <input type="number" id="lowThreshold" min="10" max="15" step="0.1" value="10.5">
                
                        <!-- Верхний порог напряжения (с меню прокрутки) -->
                        <label for="highThreshold">Верхний порог напряжения, В:</label>
                        <input type="number" id="highThreshold" min="12" max="17" step="0.1" value="14.5">
                
                        <!-- Кнопка Сохранить -->
                        <button onclick="saveBatterySettings()">Сохранить</button>
                    </div>
                </div>

        <div id="inverterModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeInverter">&times;</span>
                <p>Информация о инверторе</p>
            </div>
        </div>
     <!-- Модальное окно для логина -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <h2>Введите логин и пароль</h2>
                <input type="text" id="username" placeholder="Логин">
                <input type="password" id="password" placeholder="Пароль">
                <button onclick="login()">Войти</button>
            </div>
        </div>
    
      <!-- Модальное окно для переключения режима Wi-Fi -->
        <div id="modeConfirmationModal" class="modal">
            <div class="modal-content">
                <h2>Подтверждение переключения режима</h2>
                <p>Переключение режима Wi-Fi приведёт к перезагрузке устройства и смене режима.</p><br>
                 <p> Вы уверены, что хотите продолжить?</p>
                <button onclick="confirmModeSwitch()">Да</button>
                <button onclick="cancelModeSwitch()">Нет</button>
            </div>
        </div>
    
        <h2>FlyWheel Control Panel</h2>


        <!-- Вкладки -->
        <div class="tabs">
            <div class="tab active" onclick="openTab(event, 'control')">Управление</div>
            <div class="tab" onclick="openTab(event, 'monitor')">Мониторинг</div>
            <div class="tab" onclick="openTab(event, 'settings')">Настройки</div>
        </div>

		 <!-- Вкладка Управление -->
<div id="control" class="tabcontent active">
   
    <div class="icon-container">
             <!-- Иконка батареи -->
                
                <div class="icon battery-icon" id="batteryIcon">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                    width="600" height="300" viewBox="0 0 3100 1560" preserveAspectRatio="xMidYMid meet">
                
                    <!-- Заливка, изменяющаяся по уровню заряда -->
                    <rect id="batteryFill" x="30" y="65" width="270" height="145" fill="green" />
                
                    <!-- Контур батарейки -->
                    <g transform="translate(0.000000,1560.000000) scale(0.100000,-0.100000)" fill="none" stroke="black" stroke-width="100">
                        <path d="M415 15000 c-63 -31 -116 -93 -132 -153 -7 -28 -13 -100 -13 -159 l0
                            -108 -108 0 c-71 0 -112 -4 -120 -12 -17 -17 -17 -569 0 -586 8 -8 49 -12 120
                            -12 l108 0 0 -104 c0 -154 11 -200 62 -253 24 -24 61 -52 84 -63 39 -20 66
                            -20 1255 -20 1377 0 1275 -6 1353 81 24 26 46 62 50 80 11 56 7 1131 -5 1173
                            -6 21 -28 58 -50 81 -74 80 18 75 -1348 75 -1197 0 -1217 0 -1256 -20z m2511
                            -93 c23 -15 46 -39 53 -53 17 -38 15 -1141 -2 -1172 -7 -12 -31 -32 -52 -45
                            l-40 -22 -1205 0 -1205 0 -39 24 c-67 42 -66 29 -66 631 0 580 0 581 51 629
                            13 12 37 26 54 30 17 5 549 9 1220 8 l1190 -2 41 -28z"/>
                        </g>
                    </svg>     
                </div>
                   <!-- Иконка инвертора напряжения -->
        
                        <div class="icon inverter-icon" id="inverterIcon">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
                        width="60.000000pt" height="30.000000pt" viewBox="0 0 172.000000 85.000000"
                        preserveAspectRatio="xMidYMid meet">

                        <g transform="translate(0.000000,85.000000) scale(0.100000,-0.100000)"
                        fill="#000000" stroke="none">
                        <path d="M921 826 c-49 -27 -50 -37 -51 -404 0 -372 2 -386 55 -410 41 -19
                        697 -17 734 2 49 26 51 41 51 406 0 365 -2 380 -51 406 -39 20 -702 20 -738 0z
                        m709 -33 c0 -10 -703 -713 -712 -713 -5 0 -8 153 -8 340 0 327 1 341 20 360
                        19 19 33 20 360 20 187 0 340 -3 340 -7z m40 -373 c0 -327 -1 -341 -20 -360
                        -19 -19 -33 -20 -360 -20 -187 0 -340 3 -340 7 0 10 703 713 712 713 5 0 8
                        -153 8 -340z"/>
                        <path d="M1025 690 c-12 -4 -27 -15 -35 -25 -20 -25 7 -39 37 -20 35 23 64 18
                        111 -20 24 -19 53 -37 64 -41 50 -15 144 33 108 56 -10 6 -23 4 -37 -5 -33
                        -22 -65 -18 -103 13 -63 52 -97 62 -145 42z"/>
                        <path d="M1290 260 c0 -19 7 -20 140 -20 133 0 140 1 140 20 0 19 -7 20 -140
                        20 -133 0 -140 -1 -140 -20z"/>
                        <path d="M1290 180 c0 -18 7 -20 60 -20 53 0 60 2 60 20 0 18 -7 20 -60 20
                        -53 0 -60 -2 -60 -20z"/>
                        <path d="M1450 180 c0 -18 7 -20 60 -20 53 0 60 2 60 20 0 18 -7 20 -60 20
                        -53 0 -60 -2 -60 -20z"/>
                        <path  id="leftLine" d="M0 425 l0 -25 430 0 430 0 0 25 0 25 -430 0 -430 0 0 -25z"/>
                        </g>
                    </svg>
           
        </div>
        <!-- Иконка сети электропитания -->
          <div class="icon power-grid-icon">
         <svg width="80px" height="80px" viewBox="18.899 98.165 16.789 22.385" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <defs/>
  <g id="surface1" style="" transform="matrix(0.62827, 0, 0, 0.676721, 7.218173, 38.836369)">
    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 31.40625 88.523438 C 31.3125 88.570312 
    30.527344 89.515625 29.652344 90.628906 L 28.066406 92.65625 L 24.417969 94.328125 C 22.414062 95.25 20.695312 96.066406 
    20.59375 96.152344 C 20.4375 96.289062 20.417969 96.363281 20.394531 96.859375 L 20.367188 97.417969 L 20.121094 97.417969 
    C 19.957031 97.417969 19.808594 97.472656 19.65625 97.589844 C 19.472656 97.738281 19.429688 97.8125 19.429688 98.035156 
    C 19.429688 98.257812 19.472656 98.332031 19.65625 98.480469 C 19.816406 98.601562 19.957031 98.65625 20.128906 98.65625 
    C 20.496094 98.65625 20.464844 98.828125 20.09375 98.878906 C 19.566406 98.953125 19.292969 99.34375 19.480469 99.738281 
    C 19.59375 99.960938 19.921875 100.140625 20.238281 100.140625 C 20.332031 100.140625 20.378906 100.183594 20.378906 100.265625 
    C 20.378906 100.332031 20.429688 100.488281 20.488281 100.613281 C 20.601562 100.859375 20.988281 101.035156 21.273438 100.972656
    C 21.539062 100.914062 21.796875 100.65625 21.847656 100.394531 C 21.890625 100.171875 21.910156 100.152344 22.175781 100.117188
    C 23.019531 100 23.035156 99.078125 22.199219 98.898438 C 21.855469 98.824219 21.761719 98.65625 22.0625 98.65625 C 22.304688 
    98.65625 22.648438 98.5 22.742188 98.351562 C 22.984375 97.949219 22.640625 97.417969 22.140625 97.417969 C 21.933594 97.417969
    21.882812 97.390625 21.882812 97.292969 C 21.882812 97.167969 21.933594 97.167969 24.851562 97.167969 L 27.820312 97.167969 
    L 27.820312 99.621094 L 25.410156 100.722656 C 20.773438 102.847656 20.59375 102.941406 20.480469 103.121094 C 20.421875 
    103.226562 20.378906 103.480469 20.378906 103.765625 L 20.378906 104.230469 L 20.128906 104.230469 C 19.957031 104.230469 
    19.816406 104.285156 19.65625 104.402344 C 19.472656 104.550781 19.429688 104.625 19.429688 104.847656 C 19.429688 105.070312 
    19.472656 105.144531 19.65625 105.292969 C 19.816406 105.410156 19.957031 105.46875 20.128906 105.46875 C 20.496094 105.46875 
       20.464844 105.640625 20.101562 105.691406 C 19.59375 105.757812 19.308594 106.117188 19.457031 106.5 C 19.550781 106.742188 
       19.886719 106.953125 20.1875 106.953125 C 20.332031 106.953125 20.378906 106.984375 20.378906 107.078125 C 20.378906 
       107.144531 20.429688 107.300781 20.488281 107.425781 C 20.601562 107.671875 20.988281 107.84375 21.273438 107.785156 
       C 21.539062 107.726562 21.796875 107.46875 21.847656 107.207031 C 21.890625 106.984375 21.910156 106.964844 22.175781 
       106.929688 C 23.019531 106.8125 23.035156 105.886719 22.199219 105.707031 C 21.855469 105.632812 21.761719 105.46875 
       22.0625 105.46875 C 22.304688 105.46875 22.648438 105.3125 22.742188 105.164062 C 22.984375 104.761719 22.640625 104.230469
        22.140625 104.230469 C 21.960938 104.230469 21.882812 104.203125 21.882812 104.136719 C 21.882812 104.054688 22.253906
         104.042969 24.773438 104.042969 L 27.664062 104.042969 L 27.609375 104.242188 C 27.398438 104.929688 23.601562 119.394531
          23.601562 119.503906 C 23.601562 119.988281 24.164062 120.28125 24.660156 120.054688 C 24.765625 120.007812 26.476562 
          118.558594 28.464844 116.835938 L 32.078125 113.703125 L 34.492188 113.703125 C 36.722656 113.703125 36.902344 113.710938
           36.9375 113.808594 C 37.003906 113.996094 37.910156 117.441406 37.910156 117.503906 C 37.910156 117.542969 37.496094 
           117.214844 36.996094 116.78125 C 36.121094 116.039062 36.058594 115.996094 35.785156 115.996094 C 35.308594 115.996094 
           34.964844 116.371094 35.078125 116.773438 C 35.128906 116.929688 38.441406 119.808594 38.835938 120.03125 C 39.300781
            120.296875 39.914062 120 39.914062 119.503906 C 39.914062 119.394531 36.117188 104.929688 35.90625 104.242188
             L 35.851562 104.042969 L 38.742188 104.042969 C 41.261719 104.042969 41.632812 104.054688 41.632812 104.136719 
             C 41.632812 104.203125 41.554688 104.230469 41.375 104.230469 C 40.875 104.230469 40.53125 104.761719 40.773438
              105.164062 C 40.867188 105.3125 41.210938 105.46875 41.453125 105.46875 C 41.753906 105.46875 41.660156 105.632812
               41.316406 105.707031 C 40.480469 105.886719 40.496094 106.8125 41.339844 106.929688 C 41.605469 106.964844 41.625
                106.984375 41.667969 107.207031 C 41.71875 107.46875 41.976562 107.726562 42.242188 107.785156 C 42.527344 
                107.84375 42.914062 107.671875 43.027344 107.425781 C 43.085938 107.300781 43.136719 107.144531 43.136719
                 107.078125 C 43.136719 106.984375 43.183594 106.953125 43.335938 106.953125 C 43.628906 106.953125 
                 43.964844 106.742188 44.058594 106.5 C 44.207031 106.117188 43.921875 105.757812 43.414062 105.691406
                  C 43.050781 105.640625 43.019531 105.46875 43.386719 105.46875 C 43.558594 105.46875 43.699219 105.410156 
                  43.859375 105.292969 C 44.042969 105.144531 44.085938 105.070312 44.085938 104.847656 C 44.085938 104.625 44.042969
                   104.550781 43.859375 104.402344 C 43.699219 104.285156 43.558594 104.230469 43.386719 104.230469 L 43.136719 
                   104.230469 L 43.136719 103.765625 C 43.136719 103.480469 43.09375 103.226562 43.035156 103.125 C 42.921875 
                   102.933594 42.949219 102.945312 38.71875 101.007812 L 35.695312 99.621094 L 35.695312 97.167969 L 38.664062 
                   97.167969 C 41.582031 97.167969 41.632812 97.167969 41.632812 97.292969 C 41.632812 97.390625 41.582031 
                   97.417969 41.375 97.417969 C 40.875 97.417969 40.53125 97.949219 40.773438 98.351562 C 40.867188 98.5 
                   41.210938 98.65625 41.453125 98.65625 C 41.753906 98.65625 41.660156 98.824219 41.316406 98.898438 
                   C 40.480469 99.078125 40.496094 100 41.339844 100.117188 C 41.605469 100.152344 41.625 100.171875 
                   41.667969 100.394531 C 41.71875 100.65625 41.976562 100.914062 42.242188 100.972656 C 42.527344 101.035156
                    42.914062 100.859375 43.027344 100.613281 C 43.085938 100.488281 43.136719 100.332031 43.136719 100.265625
                     C 43.136719 100.183594 43.183594 100.140625 43.277344 100.140625 C 43.59375 100.140625 43.921875 99.960938
                      44.035156 99.738281 C 44.222656 99.34375 43.949219 98.953125 43.421875 98.878906 C 43.050781 98.828125
                       43.019531 98.65625 43.386719 98.65625 C 43.558594 98.65625 43.699219 98.601562 43.859375 98.480469 C 44.042969 
                       98.332031 44.085938 98.257812 44.085938 98.035156 C 44.085938 97.8125 44.042969 97.738281 43.859375 97.589844 
                       C 43.707031 97.472656 43.558594 97.417969 43.394531 97.417969 L 43.148438 97.417969 L 43.121094 96.859375
                        C 43.101562 96.363281 43.078125 96.289062 42.921875 96.152344 C 42.707031 95.96875 38.226562 93.898438 
                        37.925781 93.851562 C 37.683594 93.808594 37.3125 93.949219 37.195312 94.128906 C 37.074219 94.328125 
                        37.109375 94.660156 37.273438 94.839844 C 37.359375 94.933594 37.675781 95.113281 37.976562 95.25 
                        C 38.277344 95.378906 38.726562 95.589844 38.984375 95.707031 L 39.449219 95.929688 L 35.695312 95.929688 
                        L 35.695312 94.488281 C 35.6875 93.503906 35.65625 93.003906 35.601562 92.890625 C 35.550781 92.796875 
                        34.785156 91.792969 33.882812 90.65625 C 32.824219 89.304688 32.195312 88.554688 32.074219 88.511719 
                        C 31.84375 88.417969 31.621094 88.417969 31.40625 88.523438 Z M 32.671875 91.359375 L 33.554688 92.496094 
                        L 32.652344 92.511719 C 32.160156 92.519531 31.355469 92.519531 30.863281 92.511719 L 29.960938 92.496094 
                        L 30.84375 91.359375 C 31.328125 90.742188 31.738281 90.234375 31.757812 90.234375 C 31.777344 90.234375 
                        32.1875 90.742188 32.671875 91.359375 Z M 34.191406 94.847656 L 34.191406 95.929688 L 29.324219 95.929688 
                        L 29.324219 93.765625 L 34.191406 93.765625 Z M 27.800781 95.914062 C 27.785156 95.925781 26.949219 95.925781
                         25.941406 95.917969 L 24.117188 95.898438 L 25.949219 95.050781 L 27.785156 94.210938 L 27.808594 95.046875 
                         C 27.816406 95.511719 27.816406 95.894531 27.800781 95.914062 Z M 34.191406 98.285156 L 34.191406 99.335938 
                         L 29.324219 99.335938 L 29.324219 97.230469 L 34.191406 97.230469 Z M 34.191406 101.722656 L 34.191406 
                         102.804688 L 29.324219 102.804688 L 29.324219 100.636719 L 34.191406 100.636719 Z M 27.820312 101.9375 
                         L 27.820312 102.804688 L 25.949219 102.804688 C 24.917969 102.804688 24.101562 102.785156 24.128906 
                         102.761719 C 24.1875 102.710938 27.695312 101.089844 27.773438 101.078125 C 27.800781 101.070312 
                         27.820312 101.460938 27.820312 101.9375 Z M 37.609375 101.925781 C 38.605469 102.382812 39.414062 102.761719 
                         39.414062 102.78125 C 39.414062 102.792969 38.578125 102.804688 37.554688 102.804688 L 35.695312 102.804688 
                         L 35.695312 101.929688 C 35.695312 101.453125 35.722656 101.070312 35.75 101.082031 C 35.78125 101.089844 
                         36.617188 101.472656 37.609375 101.925781 Z M 34.8125 105.746094 C 35.054688 106.664062 35.25 107.417969 
                         35.242188 107.425781 C 35.214844 107.441406 30.621094 104.136719 30.621094 104.085938 C 30.613281 104.0625 
                         31.457031 104.050781 32.488281 104.054688 L 34.371094 104.074219 Z M 32.1875 106.886719 C 33.820312 108.054688
                          35.183594 109.039062 35.226562 109.070312 C 35.269531 109.101562 34.546875 109.769531 33.367188 110.792969 
                          L 31.4375 112.464844 L 29.203125 112.464844 C 27.464844 112.464844 26.964844 112.445312 26.964844 112.390625
                           C 26.964844 112.347656 27.085938 111.859375 27.226562 111.308594 L 27.492188 110.304688 L 28.367188 111.039062
                            C 29.1875 111.738281 29.261719 111.785156 29.523438 111.785156 C 30.046875 111.785156 30.414062 111.375 30.246094 110.984375 C 30.203125 110.890625 29.738281 110.441406 29.195312 109.976562 C 28.601562 109.457031 28.246094 109.101562 28.289062 109.070312 C 28.332031 109.039062 28.746094 108.742188 29.21875 108.410156 C 30.382812 107.578125 30.671875 107.335938 30.726562 107.125 C 30.820312 106.75 30.460938 106.394531 29.992188 106.394531 C 29.761719 106.394531 29.566406 106.5 28.78125 107.078125 C 28.472656 107.292969 28.238281 107.4375 28.257812 107.386719 C 28.28125 107.335938 28.460938 106.6875 28.652344 105.949219 C 28.953125 104.804688 29.015625 104.617188 29.109375 104.679688 C 29.167969 104.722656 30.546875 105.714844 32.1875 106.886719 Z M 36.050781 110.402344 C 36.050781 110.433594 36.164062 110.867188 36.300781 111.375 C 36.4375 111.882812 36.550781 112.335938 36.550781 112.378906 C 36.550781 112.445312 36.273438 112.464844 35.085938 112.464844 C 34.277344 112.464844 33.617188 112.445312 33.617188 112.421875 C 33.617188 112.359375 35.929688 110.359375 35.992188 110.359375 C 36.03125 110.359375 36.050781 110.378906 36.050781 110.402344 Z M 27.820312 115.59375 C 26.628906 116.625 25.640625 117.46875 25.625 117.457031 C 25.609375 117.441406 26.492188 114.054688 26.578125 113.808594 C 26.613281 113.710938 26.757812 113.703125 28.308594 113.703125 L 30.003906 113.703125 Z M 27.820312 115.59375 "/>
    <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 33.476562 114.308594 C 33.203125 114.425781 33.046875 114.71875 33.101562 114.992188 C 33.152344 115.203125 33.746094 115.714844 33.992188 115.757812 C 34.527344 115.847656 35 115.414062 34.84375 114.984375 C 34.71875 114.675781 34.105469 114.199219 33.820312 114.199219 C 33.769531 114.199219 33.609375 114.25 33.476562 114.308594 Z M 33.476562 114.308594 "/>
  </g>
</svg>
           
        </div>


   <!-- Иконка нагрузки -->
   <div class="icon power-icon">
    <svg version="1.0" xmlns="http://www.w3.org/2000/svg"
    width="35.000000pt" height="35.000000pt" viewBox="0 0 2000.000000 2000.000000"
    preserveAspectRatio="xMidYMid meet">
   
   <g transform="translate(0.000000,2000.000000) scale(0.100000,-0.100000)"
   fill="#000000" stroke="none">
   <path d="M9720 19994 c-368 -25 -539 -44 -777 -85 -1570 -269 -2983 -1137
   -3945 -2423 -600 -801 -993 -1717 -1162 -2711 -23 -132 -54 -389 -68 -560 -18
   -222 -15 -743 6 -945 91 -895 347 -1721 904 -2910 60 -129 274 -568 475 -975
   470 -954 617 -1272 769 -1670 210 -548 328 -1053 328 -1410 0 -409 145 -748
   423 -994 159 -140 350 -239 551 -285 155 -36 234 -37 2856 -34 l2575 4 95 21
   c382 85 693 320 863 650 102 199 133 336 147 654 15 346 63 616 174 985 149
   495 349 954 859 1979 347 695 543 1098 659 1355 482 1064 714 1856 789 2695
   16 178 16 664 0 860 -57 713 -211 1353 -473 1974 -322 762 -774 1428 -1365
   2012 -202 200 -252 246 -413 380 -985 818 -2192 1311 -3480 1419 -128 11 -691
   21 -790 14z m775 -1268 c986 -104 1871 -464 2629 -1070 763 -610 1328 -1423
   1635 -2353 216 -656 296 -1418 215 -2053 -68 -537 -248 -1140 -546 -1835 -127
   -295 -277 -609 -596 -1250 -522 -1047 -680 -1384 -862 -1840 -285 -714 -437
   -1345 -458 -1905 l-7 -175 -937 -3 -938 -2 0 1907 c0 2126 5 1979 -71 2132
   -73 147 -209 262 -372 313 -102 32 -273 32 -369 0 -195 -65 -343 -214 -416
   -419 -15 -44 -17 -194 -19 -1991 l-3 -1942 -938 2 -937 3 -2 80 c-22 785 -276
   1635 -852 2842 -59 125 -261 539 -449 918 -187 380 -381 780 -432 890 -661
   1433 -858 2348 -730 3382 128 1036 569 1995 1267 2758 894 978 2100 1550 3433
   1629 132 8 619 -4 755 -18z"/>
   <path d="M8592 14350 c-111 -29 -187 -74 -277 -165 -135 -135 -192 -281 -182
   -470 9 -161 67 -294 177 -405 75 -75 147 -120 252 -158 l73 -27 1330 -3 c1479
   -3 1419 -5 1560 64 388 190 474 695 170 1000 -83 84 -173 137 -280 164 -76 20
   -111 20 -1414 19 -1282 0 -1339 -1 -1409 -19z"/>
   <path d="M8664 12490 c-109 -16 -197 -54 -290 -123 -241 -182 -314 -531 -167
   -796 53 -97 170 -209 263 -254 146 -71 49 -67 1535 -67 1487 0 1391 -4 1535
   67 100 50 222 170 268 265 56 115 67 161 66 293 0 104 -3 130 -26 193 -70 194
   -207 331 -399 398 l-84 29 -1325 1 c-729 1 -1348 -2 -1376 -6z"/>
   <path d="M7415 4363 c-124 -16 -255 -83 -350 -178 -246 -245 -248 -630 -5
   -876 92 -93 177 -142 302 -174 56 -14 81 -24 63 -24 -52 -2 -137 -29 -215 -68
   -196 -100 -330 -322 -330 -549 0 -173 62 -318 189 -444 91 -89 167 -132 294
   -165 58 -15 80 -24 60 -25 -61 0 -191 -50 -268 -101 -170 -114 -275 -310 -275
   -515 0 -103 29 -217 77 -303 52 -95 170 -209 264 -254 139 -68 121 -67 860
   -67 l667 0 81 -92 c45 -51 87 -98 94 -103 6 -6 43 -37 81 -69 194 -164 433
   -279 688 -331 108 -21 152 -25 313 -25 161 0 205 4 313 25 327 67 585 213 834
   474 l115 121 664 0 c738 0 720 -1 859 67 105 52 222 170 273 274 142 290 47
   634 -223 808 -66 43 -197 90 -253 92 -21 0 1 9 61 24 125 32 210 81 302 174
   224 226 241 570 42 824 -46 59 -137 134 -202 167 -49 25 -166 60 -204 61 -21
   1 -4 7 49 20 129 32 218 81 310 174 118 118 171 235 182 401 16 253 -120 487
   -350 598 -145 71 51 66 -2779 65 -1404 -1 -2566 -4 -2583 -6z"/>
   </g>
   </svg>
   


    </div>

    </div>
    <br><br><br><br>
    <p>Напряжение питания, В: <span id="voltage">0</span></p>
    <p>Скорость, Об.мин.: <span id="speed">0</span></p>
    
    <!-- Ползунок для установки максимального тока -->
    <label for="maxCurrentRange">Максимальный ток, А: <span id="maxCurrentValue">1</span></label>
    <input type="range" id="maxCurrentRange" min="0" max="50" step="0.1" value="1" oninput="updateMaxCurrent(this.value)" style="width: 300px;">
</div>

        <!-- Контент вкладки Мониторинг -->
        <div id="monitor" class="tabcontent">
           
            <p>Температура: <span id="temperature">0</span>°C</p>
            <p>Ток: <span id="current">0</span> A</p>

            <!-- Контейнер для графика -->
            <div id="chartContainer">
                <canvas id="speedChart"></canvas>
            </div>
        </div>

       <!-- Контент вкладки Настройки -->
        <div id="settings" class="tabcontent">
            <p>Current IP: <span id="ip_address">Loading...</span></p>
            <p>Netmask: <span id="netmask">Loading...</span></p>
            <p>Gateway: <span id="gateway">Loading...</span></p>
            <p>Current Mode: <span id="network_mode">Loading...</span></p>
            
            <form id="wifiForm">
                <label for="wifi_ssid">Wi-Fi SSID:</label>
                <input type="text" id="wifi_ssid" name="wifi_ssid">
                
                <label for="wifi_password">Wi-Fi Password:</label>
                <input type="password" id="wifi_password" name="wifi_password">
                
                <!-- Кнопки для переключения режимов -->
                <button type="button" id="switchToAPButton" onclick="openModeConfirmation('AP')">Switch to AP</button>
                <button type="button" id="switchToSTAButton" onclick="openModeConfirmation('STA')">Switch to STA</button>
                
                <!-- Кнопка сохранения настроек -->
                <button type="button" onclick="saveSettings()">Save</button>
            </form>

                        <!-- Страница обновления прошивки -->
            <form id="uploadForm" enctype="multipart/form-data">
                <h3>Upload Firmware</h3>
                <input type="file" id="firmwareFile" name="firmware" accept=".bin">
                <br><br>
                <button type="button" onclick="uploadFirmware()">Upload Firmware</button>
                <p id="status"></p>
            </form>
        </div>
    </div>


    <script>
        // Устанавливаем уровень заряда (от 0 до 100)
        let batteryLevel = 100;
    
        // Обновляем ширину и цвет заливки в зависимости от уровня заряда
        function updateBatteryFill(level) {
            const batteryFill = document.getElementById('batteryFill');
            
            // Рассчитываем сдвиг по оси X относительно уровня заряда
            const maxFillWidth = 270; // максимальная ширина батареи
            const fillWidth = (level / 100) * maxFillWidth;
            const xPosition = 35 + (maxFillWidth - fillWidth); // сдвиг вправо по мере разряда
    
            // Меняем x-координату и ширину заливки
            batteryFill.setAttribute('x', xPosition);
            batteryFill.setAttribute('width', fillWidth);
        
            // Меняем цвет заливки в зависимости от уровня заряда
            if (level > 50) {
                // От зеленого к желтому
                batteryFill.setAttribute('fill', `rgb(${255 - (level - 50) * 5.1}, 255, 0)`);
            } else {
                // От желтого к красному
                batteryFill.setAttribute('fill', `rgb(255, ${level * 5.1}, 0)`);
            }
        }
    
        // Пример динамического изменения уровня заряда
        let currentLevel = 100;
        setInterval(() => {
            currentLevel -= 1;
            if (currentLevel < 0) {
                currentLevel = 100;
            }
            updateBatteryFill(currentLevel);
        }, 100);
    </script>



<script>
    const CHUNK_SIZE = 2048; // Размер одной части
    const MAX_RETRIES = 3;   // Максимальное количество попыток повторной отправки

    function uploadFirmware() {
        const fileInput = document.getElementById('firmwareFile');
        const status = document.getElementById('status');

        if (fileInput.files.length === 0) {
            status.innerHTML = "Please select a firmware file!";
            console.log("No file selected.");
            return;
        }

        const file = fileInput.files[0];
        const totalSize = file.size;
        let offset = 0; // Начальное смещение файла
        let chunkCounter = 1; // Счётчик частей
        let retryCount = 0; // Счётчик попыток для текущего чанка

        status.innerHTML = "Uploading firmware...";
        console.log(`Starting upload: ${file.name}, total size: ${totalSize} bytes`);

        // Функция отправки части данных
        function sendNextChunk() {
            const chunk = file.slice(offset, offset + CHUNK_SIZE);

            const formData = new FormData();
            formData.append('fileName', file.name); // Имя файла
            formData.append('totalSize', totalSize); // Общий размер файла
            formData.append('chunkNumber', chunkCounter); // Номер части
            formData.append("chunk", chunk); // Добавление части файла

            console.log(`Sending chunk ${chunkCounter} (size: ${chunk.size} bytes, attempt: ${retryCount + 1})`);

            // Отправка через fetch
            fetch('/ota', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(result => {
                console.log(`Chunk ${chunkCounter} uploaded successfully, received server response: ${result}`);
                offset += CHUNK_SIZE;
                chunkCounter++;
                retryCount = 0; // Сбросить количество попыток для следующего чанка
                status.innerHTML = `Uploaded ${Math.min(offset, totalSize)} of ${totalSize} bytes`;

                if (offset < totalSize) {
                    console.log(`Continuing upload: ${offset} of ${totalSize} bytes uploaded`);
                    sendNextChunk(); // Отправляем следующую часть только после успешного ответа
                } else {
                    status.innerHTML = "Firmware upload completed successfully!";
                    console.log("Upload completed successfully!");
                }
            })
            .catch(error => {
                console.error('Error uploading chunk:', error);
                retryCount++; // Увеличиваем количество попыток
                if (retryCount < MAX_RETRIES) {
                    console.log(`Retrying chunk ${chunkCounter} (attempt: ${retryCount + 1})`);
                    sendNextChunk(); // Повторно отправляем чанк
                } else {
                    status.innerHTML = "Error uploading firmware! Reached maximum retry attempts.";
                    console.error(`Failed to upload chunk ${chunkCounter} after ${MAX_RETRIES} attempts.`);
                }
            });
        }

        sendNextChunk(); // Начало отправки частей
    }
</script>
   <script>
            
            // Получаем элементы модальных окон
                const batteryModal = document.getElementById('batteryModal');
                const inverterModal = document.getElementById('inverterModal');
                
                // Получаем иконки
                const batteryIcon = document.getElementById('batteryIcon');
                const inverterIcon = document.getElementById('inverterIcon');
                
                // Получаем кнопки закрытия модальных окон
                const closeBattery = document.getElementById('closeBattery');
                const closeInverter = document.getElementById('closeInverter');
                
                // Открытие модального окна для батареи
                batteryIcon.onclick = function() {
                    batteryModal.style.display = 'flex';
                }
                
                // Открытие модального окна для инвертора
                inverterIcon.onclick = function() {
                    inverterModal.style.display = 'flex';
                    
                }
                
                // Закрытие модальных окон
                closeBattery.onclick = function() {
                    batteryModal.style.display = 'none';
                }
                closeInverter.onclick = function() {
                    inverterModal.style.display = 'none';
                }
                
                // Закрытие модального окна при клике вне его
                window.onclick = function(event) {
                    if (event.target == batteryModal) {
                        batteryModal.style.display = 'none';
                    }
                    if (event.target == inverterModal) {
                        inverterModal.style.display = 'none';
                    }
                }
                
    </script>



<script>
    /*
    
      // Логин и пароль для проверки
        const USERNAME = "admin";
        const PASSWORD = "12345";

        // Открытие модального окна при загрузке страницы
        window.onload = function() {
            if (!localStorage.getItem("authenticated")) {
                document.getElementById("loginModal").style.display = "flex";
                document.getElementById("content").style.display = "none"; // Скрыть содержимое до аутентификации
            }
        }

   */
			// Функция для скрытия линии
			function hideLeftLine() {
			    const leftLine = document.getElementById('leftLine');
			    if (leftLine) {
			        leftLine.style.display = 'none';  // Скрыть линию
			    }
			}
			
			// Функция для отображения линии
			function showLeftLine() {
			    const leftLine = document.getElementById('leftLine');
			    if (leftLine) {
			        leftLine.style.display = '';  // Показать линию (по умолчанию)
			    }
			}

    /*

        // Функция для входа
        function login() {
            var username = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            if (username === USERNAME && password === PASSWORD) {
                localStorage.setItem("authenticated", true); // Сохраняем статус входа
                document.getElementById("loginModal").style.display = "none"; // Скрываем модальное окно
                document.getElementById("content").style.display = "block"; // Показываем содержимое
            } else {
                alert("Неверный логин или пароль");
            }
        }
    */
    
    
        // Функция для переключения вкладок
        function openTab(event, tabName) {
            var i, tabcontent, tabs;
            
            // Скрываем все вкладки
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            
            // Убираем активный класс с вкладок
            tabs = document.getElementsByClassName("tab");
            for (i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            
            // Показываем текущую вкладку
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
        }

			

			     // Инициализация данных для графика
			var timeData = [];
			var speedData = [];
			var timeCounter = 0; // Счетчик времени в секундах
			
			var speedChart = new Chart(document.getElementById('speedChart'), {
			    type: 'line',
			    data: {
			        labels: timeData,
			        datasets: [{
			            label: 'Скорость (об/мин)',
			            data: speedData,
			            borderColor: 'rgba(75, 192, 192, 1)',
			            backgroundColor: 'rgba(75, 192, 192, 0.2)',
			            fill: true
			        }]
			    },
    options: {
        animation: {
            duration: 300, // Уменьшаем время анимации для более плавного обновления
            easing: 'easeOutQuad' // Используем более плавный эффект
        },
        scales: {
            x: {
                type: 'linear',
                position: 'bottom',
                title: {
                    display: true,
                    text: 'Время (сек)'
                }
            },
            y: {
                title: {
                    display: true,
                    text: 'Скорость (об/мин)'
                }
            }
        }
    }
});


		
		    // Функция для обновления значения максимального тока
		    function updateMaxCurrent(value) {
		        document.getElementById('maxCurrentValue').innerText = value;
		        
		        // Можно отправить это значение на сервер или использовать его для управления другими элементами
		        console.log('Установленный максимальный ток: ' + value + ' A');
		    }
		

// Функция для получения текущего времени в формате HH:MM:SS
function getCurrentTimeFormatted() {
    var now = new Date(); // Получаем текущее время

    var hours = now.getHours();   // Часы
    var minutes = now.getMinutes(); // Минуты
    var seconds = now.getSeconds(); // Секунды

    // Форматируем часы, минуты и секунды так, чтобы всегда было 2 цифры
    hours = hours < 10 ? '0' + hours : hours;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    seconds = seconds < 10 ? '0' + seconds : seconds;

    // Возвращаем строку в формате HH:MM:SS
    return hours + ':' + minutes + ':' + seconds;
}

       // Функция для обновления данных графика
function updateChart(newSpeed) {
    timeCounter++; // Увеличиваем счетчик времени
    var currentTime = getCurrentTimeFormatted();
    
    // Добавляем новые данные
    timeData.push(timeCounter);
    speedData.push(newSpeed);

    // Если массивы превышают длину 90, удаляем только первое значение
    if (timeData.length > 90) {
        timeData.shift();  
        speedData.shift();
    }

    // Обновляем график с плавной анимацией
    speedChart.update();  
}

// Функция для сохранения настроек
function saveSettings() {
    // Собираем данные из формы
    const ssid = document.getElementById('wifi_ssid').value;
    const password = document.getElementById('wifi_password').value;

    // Проверка наличия данных
    if (!ssid || !password) {
        alert("Пожалуйста, введите SSID и пароль");
        return;
    }

    // Формируем объект с данными
    const data = {
        ssid: ssid,
        password: password
    };

    // Отправляем данные на backend с использованием fetch
    fetch('/save_wifi_settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Ошибка сохранения настроек');
        }
    })
    .then(result => {
        alert('Настройки Wi-Fi сохранены');
        // Можно обновить страницу или показать сообщение о сохранении
    })
    .catch(error => {
        console.error('Ошибка:', error);
        alert('Не удалось сохранить настройки');
    });
}




function updateData() {
    const indicator = document.getElementById('connectionIndicator');
    var xhr = new XMLHttpRequest();
    var requestTimedOut = false;

    xhr.open("GET", "/data", true);
    
    // Устанавливаем таймаут на 5 секунд (5000 мс)
    xhr.timeout = 2000;

    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            if (!requestTimedOut) {
                if (xhr.status == 200) {
                    // Сервер ответил успешно, обновляем данные
                    var data = JSON.parse(xhr.responseText);
                    document.getElementById("voltage").innerText = data.voltage;
                    document.getElementById("speed").innerText = data.speed;
                    document.getElementById("temperature").innerText = data.temperature;
                    document.getElementById("current").innerText = data.current;

                    // Обновляем данные графика
                    updateChart(data.speed);

                    // Соединение установлено, индикатор становится зелёным
                    indicator.classList.add('active');
                } else {
                    // Сервер ответил с ошибкой, соединение считается потерянным
                    indicator.classList.remove('active');
                }
            }
        }
    };
    
    // Обработка ошибок сети
    xhr.onerror = function () {
        // Ошибка соединения, индикатор становится красным
        indicator.classList.remove('active');
    };

    // Обработка таймаута
    xhr.ontimeout = function () {
        // Запрос занял слишком много времени, считаем, что соединение потеряно
        requestTimedOut = true;
        indicator.classList.remove('active');
    };
    
    xhr.send();
}

        // Обновление данных каждые 1 секунду
      setInterval(updateData, 500); 
        
        
        
          function updateNetworkInfo() {
      fetch('/get_ip')
        .then(response => response.json())
        .then(data => {
            document.getElementById('ip_address').textContent = data.ip;
            document.getElementById('netmask').textContent = data.netmask;
            document.getElementById('gateway').textContent = data.gateway;
            document.getElementById('network_mode').textContent = data.mode;
             
             
             // Обновление состояния кнопок
            if (data.mode === 'AP') {
                document.getElementById('switchToAPButton').disabled = true;
                document.getElementById('switchToSTAButton').disabled = false;
            } else if (data.mode === 'STA') {
                document.getElementById('switchToAPButton').disabled = false;
                document.getElementById('switchToSTAButton').disabled = true;
            }
        })
        .catch(error => console.error('Error fetching network info:', error));
    }



     
        // Функция для открытия модального окна подтверждения переключения режима
        function openModeConfirmation(mode) {
            var modal = document.getElementById('modeConfirmationModal');
            modal.style.display = 'flex';
            modal.dataset.mode = mode; // Сохраняем режим переключения
        }

        // Функция для подтверждения переключения режима
        function confirmModeSwitch() {
            var modal = document.getElementById('modeConfirmationModal');
            var mode = modal.dataset.mode;

            // Отправляем запрос на сервер для переключения режима
            fetch('/wifi_mode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ mode: mode })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Режим успешно переключен на ' + (mode === 'AP' ? 'Access Point' : 'Station'));
                } else {
                    alert('Ошибка при переключении режима.');
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
            });

            modal.style.display = 'none';
        }

        // Функция для отмены переключения режима
        function cancelModeSwitch() {
            var modal = document.getElementById('modeConfirmationModal');
            modal.style.display = 'none';
        }

/*
function saveSettings() {
    const settings = {
        max_current: document.getElementById('maxCurrentRange').value,
        voltage_limit: document.getElementById('voltageLimit').value,
        speed_limit: document.getElementById('speedLimit').value
    };
    
    fetch('/save_settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings),
    }).then(response => {
        if (response.ok) {
            console.log('Настройки сохранены успешно');
        } else {
            console.error('Ошибка сохранения настроек');
        }
    });
}
*/

// Пример команды с бэка

// Функция для переключения видимости
function toggleVisibility() {
    const leftLine = document.getElementById('leftLine');
    if (leftLine) {
        // Если элемент видим, скрыть его, иначе показать
        if (leftLine.style.display === 'none') {
            showLeftLine();
        } else {
            hideLeftLine();
        }
    }
}

  setInterval(toggleVisibility, 500);

    // Обновление сетевых параметров каждую секунду
    setInterval(updateNetworkInfo, 1000);

    // Получение сетевых параметров сразу при загрузке страницы
    updateNetworkInfo();
    updateData();
   
    
    
    
    
    </script>
</body>
</html>
